<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XAFS å‹ç‰‡æ ·å“è®¡ç®—å™¨ (Pro Maxç‰ˆ)</title>
    <style>
        :root {
            --bg-color: #f5f7fa;
            --panel-bg: #ffffff;
            --border-color: #dcdcdc;
            --text-color: #2c3e50;
            --highlight: #3498db;
            --title-orange: #e67e22;
            --title-green: #27ae60;
            --title-blue: #2980b9;
            --warning-bg: #fff3cd;
            --warning-text: #856404;
            --danger-bg: #f8d7da;
            --danger-text: #721c24;
        }

        body {
            font-family: 'Microsoft YaHei', 'Segoe UI', sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            color: var(--text-color);
            user-select: none;
        }

        .main-container {
            display: grid;
            grid-template-columns: 1fr 1fr 1.2fr;
            gap: 15px;
            max-width: 1000px;
            margin: 0 auto;
        }

        .panel {
            background: var(--panel-bg);
            border: 1px solid var(--border-color);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
        }

        h2 {
            margin: 0 0 15px 0;
            font-size: 20px;
            font-weight: bold;
            border-bottom: 2px solid #eee;
            padding-bottom: 8px;
        }

        .title-target { color: var(--title-orange); border-color: var(--title-orange); }
        .title-matrix { color: var(--title-green); border-color: var(--title-green); }
        .title-form { color: var(--title-blue); border-color: var(--title-blue); }

        .group-box {
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 12px 10px;
            margin-bottom: 12px;
            position: relative;
        }
        .group-label {
            position: absolute;
            top: -10px;
            left: 10px;
            background: var(--panel-bg);
            padding: 0 5px;
            font-size: 12px;
            color: #7f8c8d;
            font-weight: bold;
        }

        label { display: block; font-size: 13px; margin-bottom: 4px; font-weight: 500; }
        input[type="text"], input[type="number"], select {
            width: 100%;
            padding: 6px;
            border: 1px solid #ccc;
            font-size: 14px;
            border-radius: 4px;
            box-sizing: border-box;
            transition: border 0.2s;
        }
        input:focus { border-color: var(--highlight); outline: none; }

        .row { display: flex; gap: 10px; align-items: center; margin-bottom: 10px; }
        .col { flex: 1; }
        
        .btn {
            background: #f8f9fa;
            border: 1px solid #ced4da;
            padding: 4px 12px;
            cursor: pointer;
            font-size: 12px;
            border-radius: 4px;
            color: #495057;
            transition: all 0.2s;
        }
        .btn:hover { background: #e2e6ea; }
        
        .btn-calc {
            width: 100%;
            font-size: 18px;
            font-weight: bold;
            padding: 12px;
            background: var(--highlight);
            color: white;
            border: none;
            margin: 15px 0;
            border-radius: 6px;
            box-shadow: 0 4px 6px rgba(52, 152, 219, 0.2);
            cursor: pointer;
        }
        .btn-calc:hover { background: #2980b9; transform: translateY(-1px); }

        .radio-group { display: flex; gap: 15px; font-size: 13px; align-items: center; }
        
        .value-display {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 6px;
            text-align: right;
            font-family: Consolas, monospace;
            font-size: 14px;
            border-radius: 4px;
            color: #2c3e50;
        }

        .matrix-list {
            height: 150px;
            border: 1px solid #e0e0e0;
            overflow-y: auto;
            font-size: 13px;
            margin-top: 5px;
            background: #fafafa;
            border-radius: 4px;
        }
        .matrix-item {
            padding: 6px 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .matrix-item:hover { background: #eef2f7; }
        .remove-btn { color: #e74c3c; border:none; background:none; cursor:pointer; font-weight:bold;}

        .result-box {
            text-align: center;
            background: #f0f7ff;
            padding: 15px;
            border-radius: 8px;
            border: 1px dashed #3498db;
        }
        .result-value {
            font-size: 32px;
            font-weight: bold;
            color: var(--highlight);
            display: inline-block;
            margin: 5px 0;
        }
        
        .status-bar {
            padding: 8px;
            text-align: center;
            font-weight: bold;
            border-radius: 4px;
            margin-top: 10px;
            font-size: 14px;
        }

        .helper-text { font-size: 12px; color: #95a5a6; margin-top: 4px; line-height: 1.4; }

        .warning-box {
            background-color: var(--warning-bg);
            color: var(--warning-text);
            border: 1px solid #ffeeba;
            padding: 10px;
            border-radius: 4px;
            font-size: 12px;
            margin-top: 15px;
            display: none; 
        }

        /* ä¸“é—¨é’ˆå¯¹é€å°„ä¸å¯è¡Œçš„è­¦å‘Šæ ·å¼ */
        .fluo-alert {
            background-color: var(--danger-bg);
            color: var(--danger-text);
            border: 1px solid #f5c6cb;
            padding: 12px;
            border-radius: 6px;
            margin-top: 10px;
            font-size: 13px;
            line-height: 1.6;
        }
        .fluo-alert strong { display: block; margin-bottom: 5px; font-size: 14px; }
    </style>
</head>
<body>

<div class="main-container">
    
    <!-- é¢æ¿ 1: ç›®æ ‡å…ƒç´  (TARGET) -->
    <div class="panel">
        <h2 class="title-target">1. ç›®æ ‡å…ƒç´  (Target)</h2>
        <div style="text-align: right; margin-bottom: 5px;">
            <button class="btn" onclick="clearTarget()">æ¸…ç©ºç›®æ ‡</button>
        </div>
        
        <div class="group-box" style="margin-top: 10px;">
            <div class="group-label">å«é‡æ ¼å¼ (Content Type)</div>
            <div class="radio-group">
                <label><input type="radio" name="contentType" value="mass" checked onchange="toggleContentMode()"> è´¨é‡ç™¾åˆ†æ¯” (wt%)</label>
                <label><input type="radio" name="contentType" value="atomic" onchange="toggleContentMode()"> åŸå­/æ‘©å°”æ¯”</label>
            </div>
        </div>

        <div class="row">
            <div class="col">
                <label>å…ƒç´ ç¬¦å· (Element)</label>
                <input type="text" id="targetElement" placeholder="ä¾‹å¦‚: Mo" onchange="updateTargetInfo()">
            </div>
            <div class="col">
                <label id="contentLabel">å«é‡ (wt%)</label>
                <input type="number" id="targetContent" value="10.0" step="0.1" placeholder="ä¾‹å¦‚: 10">
            </div>
        </div>

        <div class="group-box">
            <div class="group-label">å¸æ”¶è¾¹ (Edge)</div>
            <div class="radio-group">
                <label><input type="radio" name="edgeType" value="K" checked onchange="updateTargetInfo()"> K è¾¹</label>
                <label><input type="radio" name="edgeType" value="L3" onchange="updateTargetInfo()"> L3 è¾¹</label>
            </div>
        </div>

        <div class="row" style="background: #fff8e1; padding: 5px; border-radius: 4px; border: 1px solid #ffe0b2;">
            <div class="col">
                <label style="color: #e65100; font-weight:bold;">ç›®æ ‡ Edge Step (Î”Î¼x)</label>
                <input type="number" id="targetStep" value="1.0" step="0.1">
                <div class="helper-text">é»˜è®¤ 1.0 (æ¨èèŒƒå›´ 0.5 - 1.5)</div>
            </div>
        </div>

        <div class="row">
            <div class="col">
                <label>èƒ½é‡ (keV)</label>
                <div class="value-display" id="dispEnergy">--</div>
            </div>
            <div class="col">
                <label>æ³¢é•¿ (Ã…)</label>
                <div class="value-display" id="dispWave">--</div>
            </div>
        </div>

        <div style="margin-top: 10px;">
            <label>æˆªé¢å·® Î”Î¼ (cmÂ²/g) [Elamåº“]</label>
            <input type="number" id="inputDeltaMu" value="0">
        </div>
        
        <div style="margin-top: 5px;">
            <label>åŸå­é‡ (g/mol)</label>
            <div class="value-display" id="dispAtomicWeight">--</div>
        </div>
    </div>

    <!-- é¢æ¿ 2: å…¶ä»–å…ƒç´  (MATRIX) -->
    <div class="panel">
        <h2 class="title-matrix">2. å…¶ä»–å…ƒç´  (Matrix)</h2>
        <div style="text-align: right; margin-bottom: 5px;">
            <button class="btn" onclick="clearMatrix()">æ¸…ç©ºåˆ—è¡¨</button>
        </div>
        
        <div class="group-box" style="margin-top: 10px;">
            <div class="group-label">æ·»åŠ å…ƒç´  (è½½ä½“/é…ä½“)</div>
            <div class="row">
                <div class="col" style="flex: 0.6;">
                    <input type="text" id="matrixInputSym" placeholder="ç¬¦å· (å¦‚ Si)">
                </div>
                <div class="col">
                    <input type="number" id="matrixInputCont" placeholder="æ•°é‡" value="1">
                </div>
                <button class="btn" style="background:#27ae60; color:white; border:none;" onclick="addMatrixElement()">æ·»åŠ </button>
            </div>
        </div>

        <div class="matrix-list" id="matrixList">
        </div>

        <div class="helper-text" style="margin-top:10px; background:#f0f0f0; padding:8px; border-radius:4px;">
            <strong>ğŸ“ è¯´æ˜ï¼š</strong><br>
            â€¢ è¿™é‡Œè¾“å…¥é™¤ç›®æ ‡å…ƒç´ ä»¥å¤–çš„æ‰€æœ‰æˆåˆ†ã€‚<br>
            â€¢ è¾“å…¥è½½ä½“ (å¦‚ CeO2) å¯ä»¥å¸®åŠ©ä½ è®°å½•å®éªŒä¿¡æ¯ï¼Œä½†ä¸å½±å“ wt% æ¨¡å¼ä¸‹çš„è®¡ç®—ã€‚
        </div>
    </div>

    <!-- é¢æ¿ 3: è®¡ç®—ç»“æœ (CALCULATION) -->
    <div class="panel">
        <h2 class="title-form">3. è®¡ç®—ä¸åˆ¶æ ·</h2>
        
        <div class="group-box">
            <div class="group-label">å‹ç‰‡å‚æ•°</div>
            <div class="row">
                <div class="col" style="text-align: right; flex: 0.6;">
                    <label style="margin-top: 8px;">æ¨¡å…·ç›´å¾„ (mm): </label>
                </div>
                <div class="col">
                    <input type="number" id="pelletDiameter" value="13.0" step="1">
                </div>
            </div>
        </div>

        <button class="btn btn-calc" onclick="calculate()">è®¡ç®—æ ·å“é‡ (Calculate)</button>

        <!-- ç»“æœæ˜¾ç¤ºæ¡† -->
        <div class="result-box" id="resultBox">
            <div style="font-size: 14px; color: #555;">å»ºè®®ç§°å–æ ·å“è´¨é‡ (é€å°„)</div>
            <div class="result-value" id="resultWeight">--</div>
            <span style="font-size: 16px; font-weight: bold;" id="unitSpan"> mg</span>
        </div>

        <div class="status-bar" id="statusBar" style="background:#eee; color:#666;">ç­‰å¾…è®¡ç®—...</div>

        <!-- ä¸¥é‡è­¦å‘Šï¼šé€å°„ä¸å¯è¡Œ -->
        <div id="transmissionFailAlert" class="fluo-alert" style="display:none;">
            <strong>â›” é€å°„æ¨¡å¼ä¸å¯è¡Œ (Calculated Mass > 400mg)</strong>
            å½“å‰è®¡ç®—æ‰€éœ€çš„æ ·å“é‡è¿‡å¤§ï¼Œè¯´æ˜ç›®æ ‡å…ƒç´ å«é‡è¿‡ä½æˆ–å¸æ”¶å¤ªå¼±ã€‚å¼ºè¡Œå‹è¿™ä¹ˆåšçš„ç‰‡å­ä¼šå¯¼è‡´ä¸¥é‡çš„èƒŒæ™¯å¸æ”¶ï¼Œæ— æ³•å¾—åˆ°æœ‰æ•ˆæ•°æ®ã€‚<br><br>
            <span style="color:#d63031; font-weight:bold;">ğŸ‘‰ è¯·åŠ¡å¿…ä½¿ç”¨ è§å…‰æ¨¡å¼ (Fluorescence Mode)</span>
            <div style="margin-top:8px; border-top:1px dashed #e6a7ac; padding-top:8px; color:#333;">
                <strong>è§å…‰åˆ¶æ ·å»ºè®®ï¼š</strong><br>
                æ— éœ€è®¡ç®—å¸æ”¶è¾¹ã€‚è¯·ç›´æ¥ç§°å– <strong>20 - 200 mg</strong> æ ·å“ï¼Œå‹æˆä¸€ä¸ªè¡¨é¢å¹³æ•´ã€è‡´å¯†ä¸”æœ‰ä¸€å®šåšåº¦ï¼ˆæœºæ¢°å¼ºåº¦å¥½ï¼‰çš„è¯ç‰‡å³å¯ã€‚è¯·å‹¿æ·»åŠ  BN ç¨€é‡Šã€‚
            </div>
        </div>

        <hr style="border: 0; border-top: 1px solid #eee; margin: 15px 0;">

        <!-- BN å»ºè®®åŒºåŸŸ (é€å°„æ¨¡å¼ç”¨) -->
        <div id="bnSection">
            <div style="font-size: 15px; font-weight: bold; margin-bottom: 8px; color:#2c3e50;">ğŸ§ª ç¨€é‡Šå‰‚ (BN) å»ºè®®</div>
            <div id="bnAdvice" style="font-size: 13px; line-height: 1.5; color: #34495e;">
                ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®è¿›è¡Œè®¡ç®—...
            </div>
            <!-- è§å…‰æ¨¡å¼è½»å¾®è­¦å‘Š -->
            <div class="warning-box" id="fluoWarning">
                <strong>âš ï¸ æç¤ºï¼š</strong> è‹¥æ‚¨è®¡åˆ’æµ‹è¯•è§å…‰æ¨¡å¼ï¼Œè¯·å¿½ç•¥ä¸Šæ–¹çš„ç¨€é‡Šå»ºè®®ã€‚BN ç¨€é‡Šä¼šé™ä½å•ä½ä½“ç§¯å†…çš„ç›®æ ‡åŸå­æµ“åº¦ï¼Œå‡å¼±è§å…‰ä¿¡å·ã€‚
            </div>
        </div>
        
    </div>

</div>

<script>
    // --- æ•°æ®åº“ (Elam/KEK Standard) ---
    // Unit: cmÂ²/g
    const db = {
        "C": { z: 6, mass: 12.01, k_e: 0.28, k_mu: 2200 }, 
        "N": { z: 7, mass: 14.01, k_e: 0.40, k_mu: 1800 },
        "O": { z: 8, mass: 16.00, k_e: 0.54, k_mu: 1500 },
        "Al": { z: 13, mass: 26.98, k_e: 1.56, k_mu: 1200 },
        "Si": { z: 14, mass: 28.09, k_e: 1.84, k_mu: 1000 },
        "S":  { z: 16, mass: 32.06, k_e: 2.47, k_mu: 950 },
        "Ti": { z: 22, mass: 47.87, k_e: 4.97, k_mu: 850 },
        "V":  { z: 23, mass: 50.94, k_e: 5.47, k_mu: 720 },
        "Cr": { z: 24, mass: 52.00, k_e: 5.99, k_mu: 620 },
        "Mn": { z: 25, mass: 54.94, k_e: 6.54, k_mu: 540 },
        "Fe": { z: 26, mass: 55.85, k_e: 7.11, k_mu: 310 },
        "Co": { z: 27, mass: 58.93, k_e: 7.71, k_mu: 270 },
        "Ni": { z: 28, mass: 58.69, k_e: 8.33, k_mu: 240 },
        "Cu": { z: 29, mass: 63.55, k_e: 8.98, k_mu: 215 },
        "Zn": { z: 30, mass: 65.38, k_e: 9.66, k_mu: 190 },
        "Zr": { z: 40, mass: 91.22, k_e: 17.99, k_mu: 85 },
        "Mo": { z: 42, mass: 95.95, k_e: 20.00, k_mu: 69.0, l3_e: 2.52, l3_mu: 350 },
        "Ru": { z: 44, mass: 101.07, k_e: 22.12, k_mu: 55.0 },
        "Rh": { z: 45, mass: 102.91, k_e: 23.22, k_mu: 49.0 },
        "Pd": { z: 46, mass: 106.42, k_e: 24.35, k_mu: 43.0 },
        "Ag": { z: 47, mass: 107.87, k_e: 25.51, k_mu: 39.0 },
        "Ce": { z: 58, mass: 140.12, k_e: 40.44, k_mu: 14.0, l3_e: 5.72, l3_mu: 280 },
        "Pt": { z: 78, mass: 195.08, l3_e: 11.56, l3_mu: 118 },
        "Au": { z: 79, mass: 196.97, l3_e: 11.92, l3_mu: 110 },
    };

    let matrixElements = [];

    function toggleContentMode() {
        const mode = document.querySelector('input[name="contentType"]:checked').value;
        const label = document.getElementById("contentLabel");
        
        if (mode === "mass") {
            label.innerText = "å«é‡ (è´¨é‡ç™¾åˆ†æ¯” wt%)";
            document.getElementById("targetContent").placeholder = "ä¾‹å¦‚: 10";
            document.getElementById("targetContent").value = "10.0";
        } else {
            label.innerText = "åŒ–å­¦å¼æ¯”ä¾‹ (Atomic Ratio)";
            document.getElementById("targetContent").placeholder = "ä¾‹å¦‚: 1";
            document.getElementById("targetContent").value = "1.0";
        }
        renderMatrixList();
    }

    function updateTargetInfo() {
        const sym = document.getElementById('targetElement').value.trim();
        if (!sym) return;
        const fixedSym = sym.charAt(0).toUpperCase() + sym.slice(1).toLowerCase();
        
        const edge = document.querySelector('input[name="edgeType"]:checked').value;
        const data = db[fixedSym];

        if (data) {
            document.getElementById('dispAtomicWeight').innerText = data.mass;
            let energy = 0;
            let mu = 0;

            if (edge === "K") {
                energy = data.k_e;
                mu = data.k_mu;
            } else {
                energy = data.l3_e;
                mu = data.l3_mu;
            }

            if (energy) {
                document.getElementById('dispEnergy').innerText = energy.toFixed(4);
                document.getElementById('dispWave').innerText = (12.398 / energy).toFixed(4);
            } else {
                document.getElementById('dispEnergy').innerText = "N/A";
                document.getElementById('dispWave').innerText = "--";
            }

            if (mu) {
                document.getElementById('inputDeltaMu').value = mu;
            }
        }
    }

    function addMatrixElement() {
        const sym = document.getElementById('matrixInputSym').value.trim();
        if (!sym) return;
        const fixedSym = sym.charAt(0).toUpperCase() + sym.slice(1).toLowerCase();
        const content = parseFloat(document.getElementById('matrixInputCont').value);

        if (isNaN(content)) return;
        const mass = db[fixedSym] ? db[fixedSym].mass : 0;
        matrixElements.push({ sym: fixedSym, content: content, mass: mass || 50 });
        
        document.getElementById('matrixInputSym').value = "";
        document.getElementById('matrixInputSym').focus();
        renderMatrixList();
    }

    function clearMatrix() {
        matrixElements = [];
        renderMatrixList();
    }
    
    function clearTarget() {
        document.getElementById('targetElement').value = "";
        const mode = document.querySelector('input[name="contentType"]:checked').value;
        document.getElementById('targetContent').value = mode === "mass" ? "10.0" : "1.0";
        document.getElementById('dispEnergy').innerText = "--";
        document.getElementById('dispAtomicWeight').innerText = "--";
        document.getElementById('inputDeltaMu').value = "0";
    }

    function renderMatrixList() {
        const list = document.getElementById('matrixList');
        const mode = document.querySelector('input[name="contentType"]:checked').value;
        list.innerHTML = "";
        
        if (matrixElements.length === 0) {
            list.innerHTML = `<div style="padding:10px; color:#999; text-align:center;">æš‚æ— å…¶ä»–å…ƒç´ </div>`;
            return;
        }

        matrixElements.forEach((item, index) => {
            const div = document.createElement('div');
            div.className = 'matrix-item';
            let labelText = mode === "mass" ? `${item.content} wt%` : `x ${item.content}`;
            div.innerHTML = `<span><b>${item.sym}</b> : ${labelText}</span> <button class="remove-btn" onclick="removeMatrix(${index})">Ã—</button>`;
            list.appendChild(div);
        });
    }

    function calculate() {
        // Reset warnings
        document.getElementById('transmissionFailAlert').style.display = "none";
        document.getElementById('bnSection').style.display = "block";
        document.getElementById('resultBox').style.opacity = "1";

        const targetSym = document.getElementById('targetElement').value.trim();
        const fixedTargetSym = targetSym.charAt(0).toUpperCase() + targetSym.slice(1).toLowerCase();
        const targetContentVal = parseFloat(document.getElementById('targetContent').value);
        const deltaMu = parseFloat(document.getElementById('inputDeltaMu').value);
        const diameter = parseFloat(document.getElementById('pelletDiameter').value);
        const targetStep = parseFloat(document.getElementById('targetStep').value);
        const mode = document.querySelector('input[name="contentType"]:checked').value;
        const targetData = db[fixedTargetSym];

        if (!targetSym || !deltaMu || !diameter || !targetStep) {
            document.getElementById('statusBar').innerText = "é”™è¯¯ï¼šè¯·å¡«å†™å®Œæ•´çš„ç›®æ ‡å…ƒç´ ä¿¡æ¯å’Œå‚æ•°";
            document.getElementById('statusBar').style.color = "red";
            return;
        }

        let w_target = 0;
        if (mode === "mass") {
            w_target = targetContentVal / 100.0;
        } else {
            const targetAtomicMass = targetData ? targetData.mass : 0;
            if (targetAtomicMass === 0) { alert("æœªçŸ¥åŸå­é‡"); return; }
            let massFromTarget = targetContentVal * targetAtomicMass;
            let totalMolarMass = massFromTarget;
            matrixElements.forEach(m => {
                let mMass = m.mass || 0; 
                if (mMass === 0) mMass = 20; 
                totalMolarMass += (m.content * mMass);
            });
            w_target = massFromTarget / totalMolarMass;
        }

        const radiusCm = (diameter / 10) / 2;
        const areaCm2 = Math.PI * Math.pow(radiusCm, 2);
        const massG = (areaCm2 * targetStep) / (deltaMu * w_target);
        const massMg = massG * 1000;

        const resEl = document.getElementById('resultWeight');
        resEl.innerText = massMg.toFixed(1);
        
        const statusEl = document.getElementById('statusBar');
        const warningBox = document.getElementById('fluoWarning');
        const adviceBox = document.getElementById('bnAdvice');
        const failAlert = document.getElementById('transmissionFailAlert');
        
        warningBox.style.display = "block";

        // --- é€»è¾‘åˆ¤æ–­å‡çº§ ---
        // é˜ˆå€¼è®¾ä¸º 400 mgã€‚ä¸€èˆ¬æ¥è¯´ 13mm æ¨¡å…·å‹ 400mg å·²ç»å¾ˆåšäº†ï¼Œå†å¤šè¯´æ˜è½½é‡å¤ªä½ã€‚
        if (massMg > 400) {
            // é€å°„ä¸å¯è¡Œæ¨¡å¼
            statusEl.innerText = "âš ï¸ ä¸æ¨èé€å°„æ¨¡å¼ (Calculated > 400mg)";
            statusEl.style.color = "#c0392b";
            statusEl.style.background = "#fadbd8";
            
            // éšè— BN å»ºè®®ï¼Œæ˜¾ç¤ºçº¢è‰²è­¦å‘Š
            document.getElementById('bnSection').style.display = "none";
            failAlert.style.display = "block";
            
            // ç»“æœæ•°å­—å˜ç°ï¼Œè¡¨ç¤ºä¸å¯ç”¨
            document.getElementById('resultBox').style.opacity = "0.5";
            
        } else {
            // é€å°„å¯è¡Œæ¨¡å¼
            failAlert.style.display = "none";
            document.getElementById('bnSection').style.display = "block";
            document.getElementById('resultBox').style.opacity = "1";

            let statusText = "";
            let statusColor = "#333";
            let statusBg = "#eee";
            let bnAdviceHTML = "";

            if (massMg < 10) {
                statusText = "æ ·å“é‡è¿‡å°‘ï¼å»ºè®®ç¨€é‡Š";
                statusColor = "#c0392b";
                statusBg = "#fadbd8";
                bnAdviceHTML = `è®¡ç®—å€¼ä»…ä¸º <b>${massMg.toFixed(1)} mg</b>ã€‚å»ºè®®ä¸ BN æŒ‰ 1:20 æ··åˆç¨€é‡Šåç§°å–æ··åˆç²‰æœ«ã€‚`;
            } else if (massMg < 50) {
                statusText = "æ ·å“é‡åå°‘ï¼Œå»ºè®®æ·»åŠ  BN";
                statusColor = "#d35400";
                statusBg = "#fdebd0";
                let bnNeed = 150 - massMg;
                bnAdviceHTML = `å»ºè®®ç§°å– <b>${massMg.toFixed(1)} mg</b> æ ·å“ï¼Œæ·»åŠ  <b>${bnNeed.toFixed(0)} mg</b> BN (æ€»é‡çº¦ 150mg) ä»¥ä¿è¯æˆå‹ã€‚`;
            } else {
                statusText = "æ ·å“é‡é€‚ä¸­ (Good for Transmission)";
                statusColor = "#27ae60";
                statusBg = "#d5f5e3";
                bnAdviceHTML = `è®¡ç®—å€¼ <b>${massMg.toFixed(1)} mg</b> é€‚åˆç›´æ¥å‹ç‰‡ã€‚å¦‚éœ€å¢åŠ å¼ºåº¦å¯æ·»åŠ  30-50mg BNã€‚`;
            }
            
            statusEl.innerText = statusText;
            statusEl.style.color = statusColor;
            statusEl.style.background = statusBg;
            adviceBox.innerHTML = bnAdviceHTML;
        }
    }
</script>

</body>
</html>